// (c) 2010 CodePlex Foundation
Type.registerNamespace("Sys.Extended.UI.Seadragon");Type.registerNamespace("Seadragon"),function(){function o(n){return Seadragon.Utils.getMousePosition(n)}function i(n,t){var i=Seadragon.Utils.getMousePosition(n),r=Seadragon.Utils.getElementPosition(t);return i.minus(r)}function r(n,t){for(var i=document.body;t&&n!=t&&i!=t;)try{t=t.parentNode}catch(r){return!1}return n==t}function s(){u=!0}function h(){u=!1}if(!Seadragon.MouseTracker){var n=Seadragon.Utils.getBrowser()==Seadragon.Browser.IE,u=!1,f=!1,e={},t=[];(function(){n?(Seadragon.Utils.addEvent(document,"mousedown",s,!1),Seadragon.Utils.addEvent(document,"mouseup",h,!1)):(Seadragon.Utils.addEvent(window,"mousedown",s,!0),Seadragon.Utils.addEvent(window,"mouseup",h,!0))})();Seadragon.MouseTracker=function(s,h,c){function lt(){y||(Seadragon.Utils.addEvent(s,"mouseover",nt,!1),Seadragon.Utils.addEvent(s,"mouseout",tt,!1),Seadragon.Utils.addEvent(s,"mousedown",et,!1),Seadragon.Utils.addEvent(s,"mouseup",v,!1),Seadragon.Utils.addEvent(s,"click",ht,!1),y=!0,e[d]=b)}function at(){y&&(Seadragon.Utils.removeEvent(s,"mouseover",nt,!1),Seadragon.Utils.removeEvent(s,"mouseout",tt,!1),Seadragon.Utils.removeEvent(s,"mousedown",et,!1),Seadragon.Utils.removeEvent(s,"mouseup",v,!1),Seadragon.Utils.removeEvent(s,"click",ht,!1),g(),y=!1,delete e[d])}function vt(){a||(n?(Seadragon.Utils.removeEvent(s,"mouseup",v,!1),Seadragon.Utils.addEvent(s,"mouseup",ot,!0),Seadragon.Utils.addEvent(s,"mousemove",ct,!0)):(Seadragon.Utils.addEvent(window,"mouseup",st,!0),Seadragon.Utils.addEvent(window,"mousemove",it,!0)),a=!0)}function g(){a&&(n?(Seadragon.Utils.removeEvent(s,"mousemove",ct,!0),Seadragon.Utils.removeEvent(s,"mouseup",ot,!0),Seadragon.Utils.addEvent(s,"mouseup",v,!1)):(Seadragon.Utils.removeEvent(window,"mousemove",it,!0),Seadragon.Utils.removeEvent(window,"mouseup",st,!0)),a=!1)}function ft(n,t){var r=e,i;for(i in r)r.hasOwnProperty(i)&&d!=i&&r[i][n](t)}function yt(){return w}function nt(t){var t=Seadragon.Utils.getEvent(t),e,o;if((n&&a&&!r(t.srcElement,s)&&ft("onMouseOver",t),e=t.target?t.target:t.srcElement,o=t.relatedTarget?t.relatedTarget:t.fromElement,r(s,e)&&!r(s,o))&&(w=!0,typeof l.enterHandler=="function"))try{l.enterHandler(l,i(t,s),p,u)}catch(f){Seadragon.Debug.error(f.name+" while executing enter handler: "+f.message,f)}}function tt(t){var t=Seadragon.Utils.getEvent(t),e,o;if((n&&a&&!r(t.srcElement,s)&&ft("onMouseOut",t),e=t.target?t.target:t.srcElement,o=t.relatedTarget?t.relatedTarget:t.toElement,r(s,e)&&!r(s,o))&&(w=!1,typeof l.exitHandler=="function"))try{l.exitHandler(l,i(t,s),p,u)}catch(f){Seadragon.Debug.error(f.name+" while executing exit handler: "+f.message,f)}}function et(r){var r=Seadragon.Utils.getEvent(r);if(r.button!=2){if(p=!0,k=o(r),ut=k,rt=(new Date).getTime(),typeof l.pressHandler=="function")try{l.pressHandler(l,i(r,s))}catch(u){Seadragon.Debug.error(u.name+" while executing press handler: "+u.message,u)}(l.pressHandler||l.dragHandler)&&Seadragon.Utils.cancelEvent(r);n&&f?n&&t.push(b):(vt(),f=!0,t=[b])}}function v(n){var n=Seadragon.Utils.getEvent(n),r=p,u=w;if(n.button!=2){if(p=!1,typeof l.releaseHandler=="function")try{l.releaseHandler(l,i(n,s),r,u)}catch(t){Seadragon.Debug.error(t.name+" while executing release handler: "+t.message,t)}r&&u&&pt(n)}}function ot(n){var n=Seadragon.Utils.getEvent(n),i,r;if(n.button!=2){for(i=0;i<t.length;i++)if(r=t[i],!r.hasMouse())r.onMouseUp(n);g();f=!1;n.srcElement.fireEvent("on"+n.type,document.createEventObject(n));Seadragon.Utils.stopEvent(n)}}function st(n){w||v(n);g()}function ht(n){l.clickHandler&&Seadragon.Utils.cancelEvent(n)}function pt(n){var n=Seadragon.Utils.getEvent(n);if(n.button!=2){var r=(new Date).getTime()-rt,u=o(n),f=ut.distanceTo(u),e=r<=h&&f<=c;if(typeof l.clickHandler=="function")try{l.clickHandler(l,i(n,s),e,n.shiftKey)}catch(t){Seadragon.Debug.error(t.name+" while executing click handler: "+t.message,t)}}}function it(n){var n=Seadragon.Utils.getEvent(n),r=o(n),u=r.minus(k);if(k=r,typeof l.dragHandler=="function"){try{l.dragHandler(l,i(n,s),u,n.shiftKey)}catch(t){Seadragon.Debug.error(t.name+" while executing drag handler: "+t.message,t)}Seadragon.Utils.cancelEvent(n)}}function ct(n){for(var i=0;i<t.length;i++)t[i].onMouseMove(n);Seadragon.Utils.stopEvent(n)}var l=this,b=null,d=Math.random(),s=Seadragon.Utils.getElement(s),y=!1,a=!1,p=!1,w=!1,k=null,rt=null,ut=null,h=h,c=c;this.target=s;this.enterHandler=null;this.exitHandler=null;this.pressHandler=null;this.releaseHandler=null;this.clickHandler=null;this.dragHandler=null,function(){b={hasMouse:yt,onMouseOver:nt,onMouseOut:tt,onMouseUp:v,onMouseMove:it}}();this.isTracking=function(){return y};this.setTracking=function(n){n?lt():at()}}}}();