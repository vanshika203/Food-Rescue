// (c) 2010 CodePlex Foundation
(function(){function n(){Type.registerNamespace("Sys.Extended.UI");Sys.Extended.UI.RatingBehavior=function(n){Sys.Extended.UI.RatingBehavior.initializeBase(this,[n]);this._starCssClass="rating_star";this._filledStarCssClass="rating_filled";this._emptyStarCssClass="rating_empty";this._waitingStarCssClass=null;this._isServerControl=!1;this._readOnly=!1;this._ratingValue=0;this._currentRating=0;this._maxRatingValue=5;this._tag="";this._ratingDirection=0;this._stars=null;this._callbackID=null;this._mouseOutHandler=Function.createDelegate(this,this._onMouseOut);this._starClickHandler=Function.createDelegate(this,this._onStarClick);this._starMouseOverHandler=Function.createDelegate(this,this._onStarMouseOver);this._keyDownHandler=Function.createDelegate(this,this._onKeyDownBack);this._autoPostBack=!1};Sys.Extended.UI.RatingBehavior.prototype={initialize:function(){var t,n;for(Sys.Extended.UI.RatingBehavior.callBaseMethod(this,"initialize"),t=this.get_element(),this._stars=[],n=1;n<=this._maxRatingValue;n++)starElement=$get(t.id+"_Star_"+n),starElement.value=n,Array.add(this._stars,starElement),$addHandler(starElement,"click",this._starClickHandler),$addHandler(starElement,"mouseover",this._starMouseOverHandler);$addHandler(t,"mouseout",this._mouseOutHandler);$addHandler(t,"keydown",this._keyDownHandler);this._update()},dispose:function(){var i=this.get_element(),n,t;if(this._stars){for(n=0;n<this._stars.length;n++)t=this._stars[n],$removeHandler(t,"click",this._starClickHandler),$removeHandler(t,"mouseover",this._starMouseOverHandler);this._stars=null}$removeHandler(i,"mouseout",this._mouseOutHandler);$removeHandler(i,"keydown",this._keyDownHandler);Sys.Extended.UI.RatingBehavior.callBaseMethod(this,"dispose")},_onError:function(n){alert(String.format(Sys.Extended.UI.Resources.Rating_CallbackError,n))},_receiveServerData:function(n,t){t._waitingMode(!1);t.raiseEndClientCallback(n)},_onMouseOut:function(){this._readOnly||(this._currentRating=this._ratingValue,this._update(),this.raiseMouseOut(this._currentRating))},_onStarClick:function(){this._readOnly||this._ratingValue!=this._currentRating&&this.set_Rating(this._currentRating)},_onStarMouseOver:function(n){this._readOnly||(this._currentRating=this._ratingDirection==0?n.target.value:this._maxRatingValue+1-n.target.value,this._update(),this.raiseMouseOver(this._currentRating))},_onKeyDownBack:function(n){if(!this._readOnly){var t=n.keyCode?n.keyCode:n.rawEvent.keyCode;t==Sys.UI.Key.right||t==Sys.UI.Key.up?(this._currentRating=Math.min(this._currentRating+1,this._maxRatingValue),this.set_Rating(this._currentRating),n.preventDefault(),n.stopPropagation()):(t==Sys.UI.Key.left||t==Sys.UI.Key.down)&&(this._currentRating=Math.max(this._currentRating-1,1),this.set_Rating(this._currentRating),n.preventDefault(),n.stopPropagation())}},_waitingMode:function(n){for(var t,i=0;i<this._maxRatingValue;i++)t=this._ratingDirection==0?this._stars[i]:this._stars[this._maxRatingValue-i-1],this._currentRating>i?this._waitingStarCssClass&&(n?(Sys.UI.DomElement.removeCssClass(t,this._filledStarCssClass),Sys.UI.DomElement.addCssClass(t,this._waitingStarCssClass)):(Sys.UI.DomElement.removeCssClass(t,this._waitingStarCssClass),Sys.UI.DomElement.addCssClass(t,this._filledStarCssClass))):(this._waitingStarCssClass&&Sys.UI.DomElement.removeCssClass(t,this._waitingStarCssClass),Sys.UI.DomElement.removeCssClass(t,this._filledStarCssClass),Sys.UI.DomElement.addCssClass(t,this._emptyStarCssClass))},_update:function(){var i=this.get_element(),n,t;for($get(i.id+"_A").title=this._currentRating,n=0;n<this._maxRatingValue;n++)t=this._ratingDirection==0?this._stars[n]:this._stars[this._maxRatingValue-n-1],this._currentRating>n?(Sys.UI.DomElement.removeCssClass(t,this._emptyStarCssClass),Sys.UI.DomElement.addCssClass(t,this._filledStarCssClass)):(Sys.UI.DomElement.removeCssClass(t,this._filledStarCssClass),Sys.UI.DomElement.addCssClass(t,this._emptyStarCssClass))},add_Rated:function(n){this.get_events().addHandler("Rated",n)},remove_Rated:function(n){this.get_events().removeHandler("Rated",n)},raiseRated:function(n){var t=this.get_events().getHandler("Rated");t&&t(this,new Sys.Extended.UI.RatingEventArgs(n))},add_MouseOver:function(n){this.get_events().addHandler("MouseOver",n)},remove_MouseOver:function(n){this.get_events().removeHandler("MouseOver",n)},raiseMouseOver:function(n){var t=this.get_events().getHandler("MouseOver");t&&t(this,new Sys.Extended.UI.RatingEventArgs(n))},add_MouseOut:function(n){this.get_events().addHandler("MouseOut",n)},remove_MouseOut:function(n){this.get_events().removeHandler("MouseOut",n)},raiseMouseOut:function(n){var t=this.get_events().getHandler("MouseOut");t&&t(this,new Sys.Extended.UI.RatingEventArgs(n))},add_EndClientCallback:function(n){this.get_events().addHandler("EndClientCallback",n)},remove_EndClientCallback:function(n){this.get_events().removeHandler("EndClientCallback",n)},raiseEndClientCallback:function(n){var t=this.get_events().getHandler("EndClientCallback");t&&t(this,new Sys.Extended.UI.RatingCallbackResultEventArgs(n))},get_AutoPostBack:function(){return this._autoPostBack},set_AutoPostBack:function(n){this._autoPostBack=n},get_Stars:function(){return this._stars},get_Tag:function(){return this._tag},set_Tag:function(n){this._tag!=n&&(this._tag=n,this.raisePropertyChanged("Tag"))},get_CallbackID:function(){return this._callbackID},set_CallbackID:function(n){this._callbackID=n},get_RatingDirection:function(){return this._ratingDirection},set_RatingDirection:function(n){this._ratingDirection!=n&&(this._ratingDirection=n,this.get_isInitialized()&&this._update(),this.raisePropertyChanged("RatingDirection"))},get_EmptyStarCssClass:function(){return this._emptyStarCssClass},set_EmptyStarCssClass:function(n){this._emptyStarCssClass!=n&&(this._emptyStarCssClass=n,this.raisePropertyChanged("EmptyStarCssClass"))},get_FilledStarCssClass:function(){return this._filledStarCssClass},set_FilledStarCssClass:function(n){this._filledStarCssClass!=n&&(this._filledStarCssClass=n,this.raisePropertyChanged("FilledStarCssClass"))},get_WaitingStarCssClass:function(){return this._waitingStarCssClass},set_WaitingStarCssClass:function(n){this._waitingStarCssClass!=n&&(this._waitingStarCssClass=n,this.raisePropertyChanged("WaitingStarCssClass"))},get_Rating:function(){var n=Sys.Extended.UI.RatingBehavior.callBaseMethod(this,"get_ClientState");return n!==null&&n.length&&(this._ratingValue=n),this._ratingValue==""&&(this._ratingValue=null),this._ratingValue},set_Rating:function(n){if(this._ratingValue!=n&&(this._ratingValue=n,this._currentRating=n,this.get_isInitialized())){if(n<0||n>this._maxRatingValue)return;if(this._update(),Sys.Extended.UI.RatingBehavior.callBaseMethod(this,"set_ClientState",[this._ratingValue]),this.raisePropertyChanged("Rating"),this.raiseRated(this._currentRating),this._isServerControl){this._waitingMode(!0);var t=this._currentRating+";"+this._tag,i=this._callbackID;this._autoPostBack?__doPostBack(i,t):WebForm_DoCallback(i,t,this._receiveServerData,this,this._onError,!0)}}},get_MaxRating:function(){return this._maxRatingValue},set_MaxRating:function(n){this._maxRatingValue!=n&&(this._maxRatingValue=n,this.raisePropertyChanged("MaxRating"))},get_ReadOnly:function(){return this._readOnly},set_ReadOnly:function(n){this._readOnly!=n&&(this._readOnly=n,this.raisePropertyChanged("ReadOnly"))},get_StarCssClass:function(){return this._starCssClass},set_StarCssClass:function(n){this._starCssClass!=n&&(this._starCssClass=n,this.raisePropertyChanged("StarCssClass"))}};Sys.Extended.UI.RatingBehavior.registerClass("Sys.Extended.UI.RatingBehavior",Sys.Extended.UI.BehaviorBase);Sys.registerComponent(Sys.Extended.UI.RatingBehavior,{name:"rating"});Sys.Extended.UI.RatingEventArgs=function(n){Sys.Extended.UI.RatingEventArgs.initializeBase(this);this._rating=n};Sys.Extended.UI.RatingEventArgs.prototype={get_Rating:function(){return this._rating}};Sys.Extended.UI.RatingEventArgs.registerClass("Sys.Extended.UI.RatingEventArgs",Sys.EventArgs);Sys.Extended.UI.RatingCallbackResultEventArgs=function(n){Sys.Extended.UI.RatingCallbackResultEventArgs.initializeBase(this);this._result=n};Sys.Extended.UI.RatingCallbackResultEventArgs.prototype={get_CallbackResult:function(){return this._result}};Sys.Extended.UI.RatingCallbackResultEventArgs.registerClass("Sys.Extended.UI.RatingCallbackResultEventArgs",Sys.EventArgs)}window.Sys&&Sys.loader?Sys.loader.registerScript("ExtendedRating",["ExtendedBase"],n):n()})();