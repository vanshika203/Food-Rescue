// (c) 2010 CodePlex Foundation
(function(){function t(){Type.registerNamespace("Sys.Extended.UI");Sys.Extended.UI.DropShadowBehavior=function(n){Sys.Extended.UI.DropShadowBehavior.initializeBase(this,[n]);this._opacity=1;this._width=5;this._shadowDiv=null;this._trackPosition=null;this._trackPositionDelay=50;this._timer=null;this._tickHandler=null;this._roundedBehavior=null;this._shadowRoundedBehavior=null;this._rounded=!1;this._radius=5;this._lastX=null;this._lastY=null;this._lastW=null;this._lastH=null};Sys.Extended.UI.DropShadowBehavior.prototype={initialize:function(){Sys.Extended.UI.DropShadowBehavior.callBaseMethod(this,"initialize");n=this.get_element();$common.getCurrentStyle(n,"position",n.style.position)!="absolute"&&(n.style.position="relative");this._rounded&&this.setupRounded();this._trackPosition&&this.startTimer();this.setShadow()},dispose:function(){this.stopTimer();this.disposeShadowDiv();Sys.Extended.UI.DropShadowBehavior.callBaseMethod(this,"dispose")},buildShadowDiv:function(){if((n=this.get_element(),this.get_isInitialized()&&n&&this._width)&&n.style.boxShadow==undefined&&n.style.MozBoxShadow==undefined&&n.style.WebkitBoxShadow==undefined){var t=document.createElement("DIV");t.style.backgroundColor="black";t.style.position="absolute";n.id&&(t.id=n.id+"_DropShadow");this._shadowDiv=t;n.parentNode.appendChild(t);this._rounded?(this._shadowDiv.style.height=Math.max(0,n.offsetHeight-2*this._radius)+"px",this._shadowRoundedBehavior?this._shadowRoundedBehavior.set_Radius(this._radius):this._shadowRoundedBehavior=$create(Sys.Extended.UI.RoundedCornersBehavior,{Radius:this._radius},null,null,this._shadowDiv)):this._shadowRoundedBehavior&&this._shadowRoundedBehavior.set_Radius(0);this._opacity!=1&&this.setupOpacity();this.setShadow(!1,!0);this.updateZIndex()}},disposeShadowDiv:function(){this._shadowDiv&&(this._shadowDiv.parentNode&&this._shadowDiv.parentNode.removeChild(this._shadowDiv),this._shadowDiv=null);this._shadowRoundedBehavior&&(this._shadowRoundedBehavior.dispose(),this._shadowRoundedBehavior=null)},onTimerTick:function(){this.setShadow()},startTimer:function(){this._timer||(this._tickHandler||(this._tickHandler=Function.createDelegate(this,this.onTimerTick)),this._timer=new Sys.Timer,this._timer.set_interval(this._trackPositionDelay),this._timer.add_tick(this._tickHandler),this._timer.set_enabled(!0))},stopTimer:function(){this._timer&&(this._timer.remove_tick(this._tickHandler),this._timer.set_enabled(!1),this._timer.dispose(),this._timer=null)},setShadow:function(t,i){var f,r,e,u,o;(n=this.get_element(),this.get_isInitialized()&&n&&(this._width||t))&&(n.style.boxShadow==undefined&&n.style.MozBoxShadow==undefined&&n.style.WebkitBoxShadow==undefined?(f=this._shadowDiv,f||this.buildShadowDiv(),r={x:n.offsetLeft,y:n.offsetTop},(t||this._lastX!=r.x||this._lastY!=r.y||!f)&&(this._lastX=r.x,this._lastY=r.y,u=this.get_Width(),r.x+=u,r.y+=u,$common.setLocation(this._shadowDiv,r)),e=n.offsetHeight,u=n.offsetWidth,(t||e!=this._lastH||u!=this._lastW||!f)&&(this._lastW=u,this._lastH=e,this._rounded&&f&&!i?(this.disposeShadowDiv(),this.setShadow()):(this._shadowDiv.style.width=u+"px",this._shadowDiv.style.height=e+"px")),this._shadowDiv&&(this._shadowDiv.style.visibility=$common.getCurrentStyle(n,"visibility"))):(o=this._opacity==".25"?this._width+"px "+this._width+"px "+this._width+"px #D3D3D3":this._opacity==".5"?this._width+"px "+this._width+"px "+this._width+"px #778899":this._opacity==".75"?this._width+"px "+this._width+"px "+this._width+"px #808080":this._width+"px "+this._width+"px "+this._width+"px #000",n.style.boxShadow!=undefined?n.style.boxShadow=o:n.style.MozBoxShadow!=undefined?n.style.MozBoxShadow=o:n.style.WebkitBoxShadow!=undefined&&(n.style.WebkitBoxShadow=o)))},setupOpacity:function(){this.get_isInitialized()&&this._shadowDiv&&$common.setElementOpacity(this._shadowDiv,this._opacity)},setupRounded:function(){!this._roundedBehavior&&this._rounded&&(this._roundedBehavior=$create(Sys.Extended.UI.RoundedCornersBehavior,null,null,null,this.get_element()));this._roundedBehavior&&this._roundedBehavior.set_Radius(this._rounded?this._radius:0)},updateZIndex:function(){if(this._shadowDiv){var i=this.get_element(),n=i.style.zIndex,t=this._shadowDiv.style.zIndex;t&&n&&n>t||(n=Math.max(2,n),t=n-1,i.style.zIndex=n,this._shadowDiv.style.zIndex=t)}},updateRoundedCorners:function(){this.get_isInitialized()&&(this.setupRounded(),this.disposeShadowDiv(),this.setShadow())},get_Opacity:function(){return this._opacity},set_Opacity:function(n){this._opacity!=n&&(this._opacity=n,this.setShadow(),this.setupOpacity(),this.raisePropertyChanged("Opacity"))},get_Rounded:function(){return this._rounded},set_Rounded:function(n){n!=this._rounded&&(this._rounded=n,this.updateRoundedCorners(),this.raisePropertyChanged("Rounded"))},get_Radius:function(){return this._radius},set_Radius:function(n){n!=this._radius&&(this._radius=n,this.updateRoundedCorners(),this.raisePropertyChanged("Radius"))},get_Width:function(){return this._width},set_Width:function(n){n!=this._width&&(this._width=n,this._shadowDiv&&$common.setVisible(this._shadowDiv,n>0),this.setShadow(!0),this.raisePropertyChanged("Width"))},get_TrackPositionDelay:function(){return this._trackPositionDelay},set_TrackPositionDelay:function(t){t!=this._trackPositionDelay&&(this._trackPositionDelay=t,n||(n=this.get_element()),n.style.boxShadow==undefined&&n.style.MozBoxShadow==undefined&&n.style.WebkitBoxShadow==undefined&&(this._trackPosition&&(this.stopTimer(),this.startTimer()),this.raisePropertyChanged("TrackPositionDelay")))},get_TrackPosition:function(){return this._trackPosition},set_TrackPosition:function(t){t!=this._trackPosition&&(this._trackPosition=t,n||(n=this.get_element()),n.style.boxShadow==undefined&&n.style.MozBoxShadow==undefined&&n.style.WebkitBoxShadow==undefined&&(this.get_element()&&(t?this.startTimer():this.stopTimer()),this.raisePropertyChanged("TrackPosition")))}};Sys.Extended.UI.DropShadowBehavior.registerClass("Sys.Extended.UI.DropShadowBehavior",Sys.Extended.UI.BehaviorBase);Sys.registerComponent(Sys.Extended.UI.DropShadowBehavior,{name:"dropShadow"})}var n=null;window.Sys&&Sys.loader?Sys.loader.registerScript("ExtendedDropShadow",["ExtendedBase","ExtendedCommon","ExtendedTimer","ExtendedRoundedCorners"],t):t()})();