Sys.Extended.UI.HTMLEditor.MSIE_list=function(n){function e(){var v,h,i,c,s,r,e,n;if(t!=null){for(i=t.cloneNode(!1),t.parentNode.insertBefore(i,t);t.firstChild!=u[0];)i.appendChild(t.firstChild);if(i.firstChild==null&&i.parentNode.removeChild(i),t.tagName.toUpperCase()==l)for(e=0;e<u.length;e++)if(n=u[e],n.nodeType==1&&n.tagName&&n.tagName.toUpperCase()=="LI"){if(v=!1,t.parentNode.insertBefore(n,t),n.style.textAlign==""&&(n.style.textAlign=t.style.textAlign),t.childNodes.length==0&&e==u.length-1&&(t.parentNode.removeChild(t),t=null),(n.style.textAlign==""||n.style.textAlign.toLowerCase()=="left"&&!f.rtlState()||n.style.textAlign.toLowerCase()=="right"&&f.rtlState())&&(v=f.tryUnWrap(n,o),v&&(a=!0)),!v){for(h=f._doc.createElement(f.dfltBlockElement),c=n.attributes,s=0;s<c.length;++s)(r=c.item(s),r.specified)&&r.name.toLowerCase()!="style"&&h.setAttribute(r.name,r.value);for(h.style.cssText=n.style.cssText,h.tagName.toUpperCase()=="P"&&(h.style.margin="0px");n.firstChild;)h.appendChild(n.firstChild);n.parentNode.insertBefore(h,n);n.parentNode.removeChild(n)}}else t.parentNode.insertBefore(n,t);else{for(i=f._doc.createElement(l),c=t.attributes,s=0;s<c.length;++s)(r=c.item(s),r.specified)&&r.name.toLowerCase()!="style"&&i.setAttribute(r.name,r.value);for(i.style.cssText=t.style.cssText,t.parentNode.insertBefore(i,t),e=0;e<u.length;e++)n=u[e],i.appendChild(n)}if(t!=null){for(i=t.cloneNode(!1),t.parentNode.insertBefore(i,t);t.firstChild;)i.appendChild(t.firstChild);i.firstChild==null&&i.parentNode.removeChild(i);t.parentNode.removeChild(t)}}t=null;u=[]}function v(){var ot=r.firstChild,st=r.lastChild,p=r.tagName.toUpperCase(),s,a,g,ft,c,y,v,nt,rt,ut,w,b,et,n,k,tt,it;if(!Sys.Extended.UI.HTMLEditor.isInlineElement(r)&&i[0][0]==ot&&i[i.length-1][i[i.length-1].length-1]==st&&(p=="OL"||p=="UL"||p=="DL"||p=="LI"||(p=="P"||p=="DIV"||Sys.Extended.UI.HTMLEditor.isHeader(r))&&p=="LI")){if(e(),u=[],p=="LI")t=r.parentNode,u.push(r);else if(p=="P"||p=="DIV"||Sys.Extended.UI.HTMLEditor.isHeader(r))t=r.parentNode.parentNode,u.push(r.parentNode);else for(t=r,c=0;c<i.length;c++)for(y=i[c],n=0;n<y.length;n++)u.push(y[n]);e()}else if(p=="LI"&&i.length<h.length)t!=r.parentNode&&(e(),t=r.parentNode,u=[]),u.push(r);else if(p=="OL"||p=="UL"||p=="DL"){for(e(),t=r,u=[],c=0;c<i.length;c++)for(y=i[c],n=0;n<y.length;n++)u.push(y[n]);e()}else{s=null;a=null;function d(){s!=null&&s.childNodes==1&&(s.firstChild==o[0]||s.firstChild==o[1])&&(s.parentNode.insertBefore(s.firstChild,s),s.parentNode.removeChild(s));s=null}if(t!=null&&e(),g="",i.length==1&&i[0].length==1&&i[0][0].nodeType==1&&i[0][0].tagName&&(g=i[0][0].tagName.toUpperCase()),g=="OL"||g=="UL"||g=="DL"){for(v=i[0][0],t=v,u=[],c=0;c<v.childNodes.length;c++)ft=v.childNodes.item(c),u.push(ft);e()}else for(c=0;c<i.length;c++){for(y=i[c],n=0;n<y.length;n++)v=y[n],nt=v.tagName?v.tagName.toUpperCase():"",a==null&&(a=f._doc.createElement(l),v.parentNode.insertBefore(a,v)),Sys.Extended.UI.HTMLEditor.isInlineElement(v)||nt=="BR"?(s==null&&(s=f._doc.createElement("LI"),a.appendChild(s)),rt=y[y.length-1]==o[1]?y.length-1:y.length,ut=y[0]==o[0]?1:0,nt=="BR"&&n==rt-1&&n==ut?Sys.Extended.UI.HTMLEditor.isIE?(s.appendChild(f._doc.createTextNode(String.fromCharCode(160))),v.parentNode.removeChild(v)):s.appendChild(v):nt=="BR"&&n==rt-1&&n>ut?v.parentNode.removeChild(v):s.appendChild(v),nt=="BR"&&n==y.length-1&&(d(),s=null),v==o[1]&&n==y.length-1&&(d(),s=null)):(s&&s.firstChild&&d(),s==null&&(s=f._doc.createElement("LI"),a.appendChild(s)),s.appendChild(v),d());s&&s.firstChild&&d()}if(a!=null){for(w=[],n=0;n<a.childNodes.length;n++)w.push(a.childNodes.item(n).style.textAlign);for(b=1;b<w.length;b++)if(w[b-1]!=w[b])break;if(b==w.length){for(et=w[0]=="left"&&!f.rtlState()||w[0]=="right"&&f.rtlState()?"":w[0],n=0;n<a.childNodes.length;n++)a.childNodes.item(n).style.textAlign="";a.style.textAlign=et}}if(a!=null&&a.parentNode.tagName.toUpperCase()=="P"&&a.parentNode.childNodes.length==1)if(k=a.parentNode,tt=k.cloneNode(!1),k.parentNode.insertBefore(a,k),k.parentNode.removeChild(k),a.childNodes.length==1){for(it=a.firstChild;it.firstChild;)tt.appendChild(it.firstChild);it.appendChild(tt)}else delete tt}}for(var h=this.get_paragraphs(),o=this.getSelectionAfterOperation(h),r=null,i=[],f=this,t=null,u=[],l=n.toUpperCase(),a=!1,s,c=0;c<h.length;c++)s=h[c],s.length>0&&(s[0].parentNode!=r&&(i.length>0&&v(),i=[],r=s[0].parentNode),i.push(s));i.length>0&&v();t!=null&&e();this.setSelectionAfterOperation(o,a)};Sys.Extended.UI.HTMLEditor.MSIE_justify=function(n,t,i){function y(n){n!=null&&n.childNodes==1&&(n.firstChild==e[0]||n.firstChild==e[1])&&(n.parentNode.insertBefore(n.firstChild,n),n.parentNode.removeChild(n))}function p(){var vt=r.firstChild,yt=r.lastChild,at=!1,w,p,et,tt,t,c,ot,ut,st,ft,ht,a,v,k,b,nt,i,d,rt,it,g,ct,lt;if(r.tagName&&!Sys.Extended.UI.HTMLEditor.isInlineElement(r)&&f[0][0]==vt&&f[f.length-1][f[f.length-1].length-1]==yt&&(w=r.tagName.toUpperCase(),w!="TD"&&w!="TH"&&w!="FIELDSET"&&w!="LEGEND"&&(at=!0)),at)if(nt="",r.getAttribute("align")&&r.getAttribute("align").length>0&&(nt=r.getAttribute("align")),r.align&&r.align.length>0&&(nt=r.align),r.style.textAlign&&r.style.textAlign.length>0&&(nt=r.style.textAlign),r.align="",r.setAttribute("align",""),r.removeAttribute("align"),(w=="DIV"||w=="P"||Sys.Extended.UI.HTMLEditor.isHeader(r))&&n=="left"&&u)o.tryUnWrap(r,e,u)&&(l=!0);else{if(n!="remain"&&(r.style.textAlign=!(n=="left"&&u)||w=="LI"&&r.parentNode.style.textAlign.length>0?n:""),u&&(r.style.margin=w=="P"?"0px":""),w=="LI"){for(a=r.parentNode,v=[],k=0;k<a.childNodes.length;k++)a.childNodes.item(k).nodeType==1&&v.push(a.childNodes.item(k).style.textAlign);for(b=1;b<v.length;b++)if(v[b-1]!=v[b])break;if(b==v.length){for(nt=v[0]=="left"&&u?"":v[0],i=0;i<a.childNodes.length;i++)a.childNodes.item(i).nodeType==1&&(a.childNodes.item(i).style.textAlign="",u&&(a.childNodes.item(i).style.margin=a.childNodes.item(i).tagName.toUpperCase()=="P"?"0px":""));a.style.textAlign=nt}}if((w=="DIV"||w=="P"||Sys.Extended.UI.HTMLEditor.isHeader(r))&&s&&h.toUpperCase()!=w){for(d=o._doc.createElement(h),rt=r.attributes,it=0;it<rt.length;++it)(g=rt.item(it),g.specified)&&g.name.toLowerCase()!="style"&&d.setAttribute(g.name,g.value);for(d.style.cssText=r.style.cssText;r.firstChild;)d.appendChild(r.firstChild);r.parentNode.insertBefore(d,r);r.parentNode.removeChild(r)}}else for(p=null,et=0;et<f.length;et++)for(s||(p=null),tt=f[et],i=0;i<tt.length;i++)if(t=tt[i],c=t.nodeType==1&&t.tagName?t.tagName.toUpperCase():null,c!=null&&(c=="UL"||c=="OL"||c=="DL"||c=="DIV"||Sys.Extended.UI.HTMLEditor.isHeader(t)||c=="P"||c=="LI"||c=="TABLE")){if(y(p),p=null,n!="remain"&&(c=="TABLE"||u||(t.style.textAlign=n)),u&&(t.style.margin=c=="P"?"0px":""),c=="UL"||c=="OL"||c=="DL"){for(ot=0;ot<t.childNodes.length;ot++)if(ut=t.childNodes.item(ot),ut.nodeType==1)for(ut.style.textAlign="",u&&(ut.style.margin=ut.tagName.toUpperCase()=="P"?"0px":""),st=0;st<ut.childNodes.length;st++)ft=ut.childNodes.item(st),ft.nodeType==1&&ft.tagName&&(ht=ft.tagName.toUpperCase(),u&&(ft.style.margin=ht=="P"?"0px":""),(ht=="DIV"||ht=="P"||Sys.Extended.UI.HTMLEditor.isHeader(ft))&&o.tryUnWrap(ft,e,u)&&(l=!0));n=="left"&&u&&(t.style.textAlign="");continue}else if(c=="LI"){for(n!="remain"&&(t.style.textAlign=!(n=="left"&&u)||t.parentNode.style.textAlign.length>0?n:""),u&&(t.style.margin=c=="P"?"0px":""),a=t.parentNode,v=[],k=0;k<a.childNodes.length;k++)a.childNodes.item(k).nodeType==1&&v.push(a.childNodes.item(k).style.textAlign);for(b=1;b<v.length;b++)if(v[b-1]!=v[b])break;if(b==v.length){for(nt=v[0]=="left"&&u?"":v[0],i=0;i<a.childNodes.length;i++)a.childNodes.item(i).nodeType==1&&(a.childNodes.item(i).style.textAlign="",u&&(a.childNodes.item(i).style.margin=a.childNodes.item(i).tagName.toUpperCase()=="P"?"0px":""));a.style.textAlign=nt}continue}else c=="TABLE"&&n!="remain"&&(n=="left"&&u?(t.align="",t.removeAttribute("align")):t.align=n);if((c=="DIV"||c=="P"||Sys.Extended.UI.HTMLEditor.isHeader(t))&&n=="left"&&u&&o.tryUnWrap(t,e,u)&&(l=!0),(c=="DIV"||c=="P"||Sys.Extended.UI.HTMLEditor.isHeader(t))&&s&&h.toUpperCase()!=c){for(d=o._doc.createElement(h),rt=t.attributes,it=0;it<rt.length;++it)(g=rt.item(it),g.specified)&&g.name.toLowerCase()!="style"&&d.setAttribute(g.name,g.value);for(d.style.cssText=t.style.cssText;t.firstChild;)d.appendChild(t.firstChild);t.parentNode.insertBefore(d,t);t.parentNode.removeChild(t)}}else n=="left"&&u&&!s||(p==null&&(p=o._doc.createElement(s?h:o.dfltBlockElement),o.dfltBlockElement.toUpperCase()!="P"||s||(p.style.margin="0px"),s||(p.style.textAlign=n),t.parentNode.insertBefore(p,t)),ct=tt[tt.length-1]==e[1]?tt.length-1:tt.length,lt=tt[0]==e[0]?1:0,c=="BR"&&i==ct-1&&i==lt?Sys.Extended.UI.HTMLEditor.isIE?(p.appendChild(o._doc.createTextNode(String.fromCharCode(160))),t.parentNode.removeChild(t)):p.appendChild(t):c=="BR"&&i==ct-1&&i>lt&&(!s||t.nextSibling!=null&&t.nextSibling==e[1])?t.parentNode.removeChild(t):p.appendChild(t),c!="BR"||i!=tt.length-1||s||(y(p),p=null),t==e[1]&&i==tt.length-1&&(y(p),p=null))}for(var v=this.get_paragraphs(),e=this.getSelectionAfterOperation(v),r=null,f=[],o=this,u=typeof t!="undefined"&&t?!0:!1,s=typeof i=="string"?!0:!1,h=typeof i=="string"?i:"",l=!1,c,a=0;a<v.length;a++)c=v[a],c.length>0&&(c[0].parentNode!=r&&(f.length>0&&p(),f=[],r=c[0].parentNode),f.push(c));f.length>0&&p();this.setSelectionAfterOperation(e,l)};Sys.Extended.UI.HTMLEditor.MSIE_indent=function(n){function e(n){if(n.nodeType==1){var t=i.rtlState()?n.style.marginRight:n.style.marginLeft;if(t.length>0)return parseInt(t)}return 0}function u(n,t){n.nodeType==1&&(n.tagName.toUpperCase()=="P"&&t==""&&(t="0px"),i.rtlState()?n.style.marginRight=t:n.style.marginLeft=t)}function l(t){n?u(t,e(t)+40+"px"):t.tagName.toUpperCase()=="P"?e(t)>=40?u(t,e(t)-40+"px"):u(t,"0px"):e(t)>40?u(t,e(t)-40+"px"):u(t,"")}function a(n){n!=null&&n.childNodes==1&&(n.firstChild==f[0]||n.firstChild==f[1])&&(n.parentNode.insertBefore(n.firstChild,n),n.parentNode.removeChild(n))}function v(){var ht=t.firstChild,ct=t.lastChild,nt,rt,p,k,h,y,ut,it,ft,g,et,w,v,d,b,tt,c,o,ot,st;if(t.tagName&&!Sys.Extended.UI.HTMLEditor.isInlineElement(t)&&r[0][0]==ht&&r[r.length-1][r[r.length-1].length-1]==ct){if(o="",t.getAttribute("align")&&t.getAttribute("align").length>0&&(o=t.getAttribute("align")),t.align&&t.align.length>0&&(o=t.align),t.style.textAlign&&t.style.textAlign.length>0&&(o=t.style.textAlign),(o.toLowerCase()=="left"&&!i.rtlState()||o.toLowerCase()=="right"&&i.rtlState())&&(o=""),t.align="",t.setAttribute("align",""),t.removeAttribute("align"),l(t),nt=t.tagName.toUpperCase(),(nt=="DIV"||nt=="P"||Sys.Extended.UI.HTMLEditor.isHeader(t))&&o=="")i.tryUnWrap(t,f)&&(s=!0);else if(t.style.textAlign=o!=""||nt=="LI"&&t.parentNode.style.textAlign.length>0?o:"",nt=="LI"){for(w=t.parentNode,v=[],d=0;d<w.childNodes.length;d++)v.push(e(w.childNodes.item(d)));for(b=1;b<v.length;b++)if(v[b-1]!=v[b])break;if(b==v.length){for(tt=v[0]==0?"":v[0]+"px",c=0;c<w.childNodes.length;c++)u(w.childNodes.item(c),"");u(w,tt)}}}else for(rt=0;rt<r.length;rt++)for(p=null,k=r[rt],c=0;c<k.length;c++)if(h=k[c],y=h.nodeType==1&&h.tagName?h.tagName.toUpperCase():null,y!=null&&(y=="UL"||y=="OL"||y=="DL"||y=="DIV"||Sys.Extended.UI.HTMLEditor.isHeader(h)||y=="P"||y=="LI")){if(a(p),p=null,l(h),y=="UL"||y=="OL"||y=="DL"){for(ut=0;ut<h.childNodes.length;ut++)if(it=h.childNodes.item(ut),it.nodeType==1)for(u(it,""),ft=0;ft<it.childNodes.length;ft++)g=it.childNodes.item(ft),o=g.nodeType==1?h.style.textAlign:"",(o.toLowerCase()=="left"&&!i.rtlState()||o.toLowerCase()=="right"&&i.rtlState())&&(o=""),g.nodeType==1&&(u(g,""),o==""&&g.tagName&&(et=g.tagName.toUpperCase(),(et=="DIV"||et=="P")&&i.tryUnWrap(g,f)&&(s=!0)));continue}else if(y=="LI"){for(w=h.parentNode,v=[],d=0;d<w.childNodes.length;d++)v.push(e(w.childNodes.item(d)));for(b=1;b<v.length;b++)if(v[b-1]!=v[b])break;if(b==v.length){for(tt=v[0]==0?"":v[0]+"px",c=0;c<w.childNodes.length;c++)u(w.childNodes.item(c),"");u(w,tt)}continue}o=h.style.textAlign;(o.toLowerCase()=="left"&&!i.rtlState()||o.toLowerCase()=="right"&&i.rtlState())&&(o="");(y=="DIV"||y=="P"||Sys.Extended.UI.HTMLEditor.isHeader(h))&&o==""&&i.tryUnWrap(h,f)&&(s=!0)}else n&&(p==null&&(p=i._doc.createElement(i.dfltBlockElement),i.dfltBlockElement.toUpperCase()=="P"&&(p.style.margin="0px"),l(p),h.parentNode.insertBefore(p,h)),ot=k[k.length-1]==f[1]?k.length-1:k.length,st=k[0]==f[0]?1:0,y=="BR"&&c==ot-1&&c==st?Sys.Extended.UI.HTMLEditor.isIE?(p.appendChild(i._doc.createTextNode(String.fromCharCode(160))),h.parentNode.removeChild(h)):p.appendChild(h):y=="BR"&&c==ot-1&&c>st?h.parentNode.removeChild(h):p.appendChild(h),y=="BR"&&c==k.length-1&&(a(p),p=null),h==f[1]&&c==k.length-1&&(a(p),p=null))}for(var c=this.get_paragraphs(),f=this.getSelectionAfterOperation(c),t=null,r=[],i=this,s=!1,o,h=0;h<c.length;h++)o=c[h],o.length>0&&(o[0].parentNode!=t&&(r.length>0&&v(),r=[],t=o[0].parentNode),r.push(o));r.length>0&&v();this.setSelectionAfterOperation(f,s)};Sys.Extended.UI.HTMLEditor.getSelectionAfterOperation=function(n){var f,e,o,i;if(n.length==0)return[];var u=this._doc.createElement("SPAN"),r=this._doc.createElement("SPAN"),s=n[0][0],t=n[n.length-1][n[n.length-1].length-1];if(s==t&&t.nodeType==1&&t.childNodes.length==0&&Sys.Extended.UI.HTMLEditor.canHaveChildren(t))t.appendChild(u),t.appendChild(r);else{if(f=Sys.Extended.UI.HTMLEditor._getReallyFirst(s),f.parentNode.insertBefore(u,f),f==s){for(e=[],e.push(u),o=0;o<n[0].length;o++)e.push(n[0][o]);n[0]=e}i=Sys.Extended.UI.HTMLEditor._getReallyLast(t);i.nextSibling?i.parentNode.insertBefore(r,i.nextSibling):i.parentNode.appendChild(r);i==t&&n[n.length-1].push(r)}return[u,r]};Sys.Extended.UI.HTMLEditor.setSelectionAfterOperation=function(n,t){var o,c,s,y,a,v,l,u;if(n.length!=0){var r=n[0],i=n[1],e=this._getSelection(),f=null,h=null;if(Sys.Extended.UI.HTMLEditor.isIE){e.empty();e=this._getSelection();o=this._createRange(e);c=this._createRange(e);try{r!=null&&i!=null&&r.nextSibling==i&&(f=this._doc.createTextNode(" "),i.parentNode.insertBefore(f,i));this._TcurrentFormat=null;r!=null&&o.moveToElementText(r);i!=null&&c.moveToElementText(i);r!=null&&i!=null?(o.setEndPoint("EndToStart",c),o.select(),f!=null&&(o.collapse(!1),o.select(),f.parentNode.removeChild(f))):r!=null?o.select():i!=null&&c.select()}catch(p){}}else try{s=r.nextSibling;y=i.previousSibling;this._TcurrentFormat=null;s==y&&s.nodeType==1&&s.tagName.toUpperCase()=="BR"?(a=Sys.Extended.UI.HTMLEditor.__getIndex(s),u=this._doc.createRange(),u.setStart(s.parentNode,a),u.setEnd(s.parentNode,a)):(f=this._doc.createTextNode(""),h=this._doc.createTextNode(""),r.parentNode.insertBefore(f,r),i.parentNode.insertBefore(h,i),u=this._doc.createRange(),u.setStart(f,0),u.setEnd(h,0));this._removeAllRanges(e);this._selectRange(e,u)}catch(p){}v=Sys.Extended.UI.HTMLEditor._commonTotalParent(r==null?i:r,i==null?r:i);l=null;v!=null&&(l=v.parent);r!=null&&r.parentNode.removeChild(r);i!=null&&i.parentNode.removeChild(i);t&&l!=null&&(Sys.Extended.UI.HTMLEditor.spanJoiner(l,this._doc),Sys.Extended.UI.HTMLEditor.isIE||f==null||h==null||(u=this._doc.createRange(),u.setStart(f,0),u.setEnd(h,0),this._removeAllRanges(e),this._selectRange(e,u)))}};Sys.Extended.UI.HTMLEditor.get_paragraphs=function(){var n,t;if(this._TcurrentFormat=null,n=this.getPseudoP(),n.length==0)try{t="<span id='"+Sys.Extended.UI.HTMLEditor.smartClassName+"_ll'><\/span><span id='"+Sys.Extended.UI.HTMLEditor.smartClassName+"_rr'><\/span><br>";this.insertHTML(t);var i=this._doc.getElementById(Sys.Extended.UI.HTMLEditor.smartClassName+"_ll"),r=this._doc.getElementById(Sys.Extended.UI.HTMLEditor.smartClassName+"_rr"),u=this._TcurrentFormat;this._TcurrentFormat=null;this.setSelectionAfterOperation([i,r],!1);this._TcurrentFormat=u;n=this.getPseudoP()}catch(f){}return n};Sys.Extended.UI.HTMLEditor.getPseudoP=function(){var b=[],n,t,c,l,d,nt,y,f,a,tt,i,it,p,g,rt,w,r,ut,u;try{var e=this._getSelection(),o=this._createRange(e),v=Sys.Extended.UI.HTMLEditor.smartClassName+"_right",k=Sys.Extended.UI.HTMLEditor.smartClassName+"_left",s=null,h=null;if(Sys.Extended.UI.HTMLEditor.isIE?e.type.toLowerCase()!="control"&&(s=o.duplicate(),h=o.duplicate(),s.setEndPoint("EndToStart",o),h.setEndPoint("StartToEnd",o)):(s=o.cloneRange(),h=o.cloneRange(),s.setEnd(s.startContainer,s.startOffset),h.setStart(h.endContainer,h.endOffset)),n=null,t=null,Sys.Extended.UI.HTMLEditor.isIE&&e.type.toLowerCase()=="control")c=o.item(0),l=this._doc.createElement("SPAN"),l.id=k,c.parentNode.insertBefore(l,c),l=this._doc.createElement("SPAN"),l.id=v,c.nextSibling==null?c.parentNode.appendChild(l):c.parentNode.insertBefore(l,c.nextSibling);else{if(!this.insertHTML("<span id='"+v+"'/>",h))return[];if(!this.insertHTML("<span id='"+k+"'/>",s))return d=this._doc.getElementById(v),d!=null&&(a=d.parentNode,a.removeChild(d)),[]}if(n=this._doc.getElementById(k),t=this._doc.getElementById(v),n!=null&&t!=null)while(n.nextSibling==null)n.parentNode.nextSibling?n.parentNode.parentNode.insertBefore(n,n.parentNode.nextSibling):n.parentNode.parentNode.appendChild(n);if(n!=null&&t!=null){while(t.previousSibling==null)t.parentNode.parentNode.insertBefore(t,t.parentNode);t.previousSibling.nodeType==1&&(nt=t.previousSibling.tagName.toUpperCase(),nt!="BR"&&nt!="IMG"&&(y=Sys.Extended.UI.HTMLEditor._getReallyLast(t.previousSibling),y.nodeType==1&&Sys.Extended.UI.HTMLEditor.canHaveChildren(y)?y.appendChild(t):y.parentNode.appendChild(t)));t.previousSibling&&t.previousSibling.nodeType==1&&t.previousSibling.tagName.toUpperCase()=="BR"&&t.parentNode.insertBefore(t,t.previousSibling)}for(n==null&&(r=this._doc.createElement("SPAN"),r.id=k,t.parentNode.insertBefore(r,t),n=r),t==null&&(r=this._doc.createElement("SPAN"),r.id=v,n.nextSibling?n.parentNode.insertBefore(r,n.nextSibling):n.parentNode.appendChild(r),t=r),n!=null&&t!=null&&(n.parentNode==t?t.parentNode.insertBefore(n,t):t.parentNode==n&&(n.nextSibling!=null?n.parentNode.insertBefore(t,n.nextSibling):n.parentNode.appendChild(t)));n.nextSibling!=null&&n.nextSibling.nodeType==3&&(""+n.nextSibling.data+"").length==0;)n.parentNode.removeChild(n.nextSibling);if(this._TcurrentFormat==null&&n!=null&&t!=null&&n.nextSibling==t){for(f=t.parentNode,this._TcurrentFormat=null;f&&f.tagName.toUpperCase()!="BODY"&&Sys.Extended.UI.HTMLEditor.isStyleTag(f.tagName);)f.tagName.toUpperCase()!="A"&&(a=f.cloneNode(!1),this._TcurrentFormat==null?this._TcurrentFormat=a:(a.appendChild(this._TcurrentFormat),this._TcurrentFormat=a)),f=f.parentNode;this._TcurrentFormat&&(tt=this._doc.createElement("span"),tt.appendChild(this._TcurrentFormat),this._TcurrentFormat=tt.innerHTML)}for(i=n;i&&i.tagName&&Sys.Extended.UI.HTMLEditor.isStyleTag(i.tagName)&&i.tagName.toUpperCase()!="A";)i=i.parentNode;for(i!=null&&i.tagName.toUpperCase()=="P"?i.firstChild!=null?i.insertBefore(n,i.firstChild):i.appendChild(n):Sys.Extended.UI.HTMLEditor.positionInParagraph(n,n.previousSibling,!0,n.parentNode),i=t;i&&i.tagName&&Sys.Extended.UI.HTMLEditor.isStyleTag(i.tagName)&&i.tagName.toUpperCase()!="A";)i=i.parentNode;if(i!=null&&i.tagName.toUpperCase()=="P"?i.appendChild(t):Sys.Extended.UI.HTMLEditor.positionInParagraph(t,t.nextSibling,!1,t.parentNode),b=this.getPseudoP_Recur(n,t,0),it=n.parentNode.tagName.toUpperCase(),b.length==0&&n.previousSibling==null&&t.nextSibling==null&&n.nextSibling==t&&(it=="P"||llpTagName=="DIV"||it=="LI")&&(b=[[n.parentNode]]),Sys.Extended.UI.HTMLEditor.isIE){e.empty();e=this._getSelection();p=this._createRange(e);g=this._createRange(e);try{n!=null&&p.moveToElementText(n);t!=null&&g.moveToElementText(t);n!=null&&t!=null?(p.setEndPoint("EndToEnd",g),p.select()):n!=null?p.select():t!=null&&g.select()}catch(ft){}}n!=null&&n.parentNode.removeChild(n);t!=null&&t.parentNode.removeChild(t)}catch(ft){for(rt=this._doc.getElementsByTagName("SPAN"),w=[],u=0;u<rt.length;u++)r=rt[u],r.id&&r.id.length>0&&(ut=new RegExp(Sys.Extended.UI.HTMLEditor.smartClassName,"ig"),ut.test(r.id)&&w.push(r));for(u=0;u<w.length;u++)w[u].parentNode.removeChild(w[u])}return b};Sys.Extended.UI.HTMLEditor.getPseudoP_Recur=function(n,t,i){var y=[],u=n,l=t.nextSibling!=null&&t.nextSibling.tagName&&t.nextSibling.tagName.toUpperCase()=="BR"?t.nextSibling:t,a=null,ft,st,kt,vt,dt,ht,g,wt,nt,b,e,v,tt,it,rt,k,et,ot,d,ut;if(u==null||l==null?(u!=null&&(a=Sys.Extended.UI.HTMLEditor._commonTotalParent(u,u)),l!=null&&(a=Sys.Extended.UI.HTMLEditor._commonTotalParent(l,l))):a=Sys.Extended.UI.HTMLEditor._commonTotalParent(u,l),a!=null){for(u=Sys.Extended.UI.HTMLEditor.getContainer(a.parent.childNodes.item(a.indexFirst),u),l=Sys.Extended.UI.HTMLEditor.getContainer(a.parent.childNodes.item(a.indexLast),l),Sys.Extended.UI.HTMLEditor.unStyle(u),Sys.Extended.UI.HTMLEditor.unStyle(l);u.parentNode!=a.parent;)u=u.parentNode;while(l.parentNode!=a.parent)l=l.parentNode;Sys.Extended.UI.HTMLEditor._moveTagsUp(u.nextSibling,l);a=null;n==null||t==null?(n!=null&&(a=Sys.Extended.UI.HTMLEditor._commonTotalParent(n,n)),t!=null&&(a=Sys.Extended.UI.HTMLEditor._commonTotalParent(t,t))):a=Sys.Extended.UI.HTMLEditor._commonTotalParent(n,t);a!=null&&Sys.Extended.UI.HTMLEditor.spanJoiner(a.parent,this._doc,a.indexFirst,a.indexLast+1,!0);function bt(n){var t,i;if(Sys.Extended.UI.HTMLEditor.isInlineElement(n)){if(n.tagName&&Sys.Extended.UI.HTMLEditor.isStyleTag(n.tagName)&&n.tagName.toUpperCase()!="A"&&!Sys.Extended.UI.HTMLEditor.isTempElement(n))for(t=n.firstChild;t!=null;){if(nnnNext=t.nextSibling,i=bt(t),i)return!0;t=nnnNext}}else return!0;return!1}var s=0,f=[],h=0;if(u.tagName&&l.tagName)if(ft=u.tagName.toUpperCase(),st=l.tagName.toUpperCase(),(ft=="TD"||ft=="TR")&&(st=="TD"||st=="TR")){while(u.tagName.toUpperCase()!="TABLE")u=u.parentNode;l=u}else if((ft=="DD"||ft=="DT")&&(st=="DD"||st=="DT")){while(u.tagName&&u.tagName.toUpperCase()!="DL")u=u.parentNode;l=u}else if(ft=="LI"&&st=="LI"){while(ft!="UL"&&ft!="OL")u=u.parentNode,ft=u.tagName?u.tagName.toUpperCase():null;l=u}for(var p=n?n:t,w=t?t:n,r=u;;){if(!Sys.Extended.UI.HTMLEditor.isTempElement(r))if(kt=bt(r),kt)if(r.tagName&&r.tagName.toUpperCase()=="BR")f[h]=r,y[s]=f,s++,f=[],h=0;else if(r!=l&&r!=u||(r==l&&r==u?Sys.Extended.UI.HTMLEditor._reallyFirst(r,p)&&Sys.Extended.UI.HTMLEditor._reallyLast(r,w):Sys.Extended.UI.HTMLEditor._reallyFirst(r,p)||Sys.Extended.UI.HTMLEditor._reallyLast(r,w)))h>0&&(y[s]=f,s++,f=[],h=0),f[h]=r,y[s]=f,s++,f=[],h=0;else if(ht=r.tagName?r.tagName.toUpperCase():null,ht=="TABLE"||ht=="TBODY"){for(g=r;g.tagName.toUpperCase()!="TABLE";)g=g.parentNode;var gt=0,yt=0,ni=g.rows.item(g.rows.length-1).cells.length-1,pt=g.rows.length-1;for(e=0;e<g.rows.length;e++)for(wt=g.rows.item(e),nt=0;nt<wt.cells.length;nt++)b=wt.cells.item(nt),Sys.Extended.UI.HTMLEditor._lookChild(b,p)>=0&&(gt=nt,yt=e),Sys.Extended.UI.HTMLEditor._lookChild(b,w)>=0&&(ni=nt,pt=e);for(e=yt;e<=pt;e++)for(nt=e==yt?gt:0;nt<=(e==pt?ni:g.rows.item(e).cells.length-1);nt++)if(b=g.rows.item(e).cells.item(nt),h>0&&(y[s]=f,s++,f=[],h=0),tt=Sys.Extended.UI.HTMLEditor._lookChild(b,p)>=0,it=Sys.Extended.UI.HTMLEditor._lookChild(b,w)>=0,tt||it){var o=p,c=w,ct=Sys.Extended.UI.HTMLEditor.smartClassName+"_right_"+i,lt=Sys.Extended.UI.HTMLEditor.smartClassName+"_left_"+i;for(tt&&(c=this._doc.createElement("span"),c.id=ct,b.appendChild(c)),it&&(o=this._doc.createElement("span"),o.id=lt,b.firstChild?b.insertBefore(o,b.firstChild):b.appendChild(o)),rt=this.getPseudoP_Recur(o,c,i+1),k=0;k<rt.length;k++)y[s]=rt[k],s++;o!=p&&o.parentNode.removeChild(o);c!=w&&c.parentNode.removeChild(c)}else{for(et=0,ot=b.childNodes.length,d=et;d<ot;d++)ut=b.childNodes.item(d),Sys.Extended.UI.HTMLEditor.isTempElement(ut)||(f[h]=ut,h++);f.length>0&&(y[s]=f,s++,f=[],h=0)}}else if(ht=="UL"||ht=="OL"||ht=="DL"){var at=r,ti=0,ii=at.childNodes.length-1;for(e=0;e<at.childNodes.length;e++)v=at.childNodes.item(e),v.nodeType==1&&((v==p||Sys.Extended.UI.HTMLEditor._lookChild(v,p)>=0)&&(ti=e),(v==w||Sys.Extended.UI.HTMLEditor._lookChild(v,w)>=0)&&(ii=e));for(e=ti;e<=ii;e++)if(v=at.childNodes.item(e),h>0&&(y[s]=f,s++,f=[],h=0),tt=Sys.Extended.UI.HTMLEditor._lookChild(v,p)>=0,it=Sys.Extended.UI.HTMLEditor._lookChild(v,w)>=0,tt||it){var o=p,c=w,ct=Sys.Extended.UI.HTMLEditor.smartClassName+"_right_"+i,lt=Sys.Extended.UI.HTMLEditor.smartClassName+"_left_"+i;for(tt&&(c=this._doc.createElement("span"),c.id=ct,v.appendChild(c)),it&&(o=this._doc.createElement("span"),o.id=lt,v.firstChild?v.insertBefore(o,v.firstChild):v.appendChild(o)),rt=this.getPseudoP_Recur(o,c,i+1),k=0;k<rt.length;k++)y[s]=rt[k],s++;o!=p&&o.parentNode.removeChild(o);c!=w&&c.parentNode.removeChild(c)}else{for(et=0,ot=v.childNodes.length,d=et;d<ot;d++)ut=v.childNodes.item(d),Sys.Extended.UI.HTMLEditor.isTempElement(ut)||(f[h]=ut,h++);f.length>0&&(y[s]=f,s++,f=[],h=0)}}else if(tt=Sys.Extended.UI.HTMLEditor._lookChild(r,p)>=0,it=Sys.Extended.UI.HTMLEditor._lookChild(r,w)>=0,h>0&&(y[s]=f,s++,f=[],h=0),tt||it){var o=p,c=w,ct=Sys.Extended.UI.HTMLEditor.smartClassName+"_right_"+i,lt=Sys.Extended.UI.HTMLEditor.smartClassName+"_left_"+i;for(tt&&(c=this._doc.createElement("span"),c.id=ct,r.appendChild(c)),it&&(o=this._doc.createElement("span"),o.id=lt,r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o)),rt=this.getPseudoP_Recur(o,c,i+1),k=0;k<rt.length;k++)y[s]=rt[k],s++;o!=p&&o.parentNode.removeChild(o);c!=w&&c.parentNode.removeChild(c)}else{for(et=0,ot=r.childNodes.length,d=et;d<ot;d++)ut=r.childNodes.item(d),Sys.Extended.UI.HTMLEditor.isTempElement(ut)||(f[h]=ut,h++);f.length>0&&(y[s]=f,s++,f=[],h=0)}else{if(r.nodeType&&r.nodeType==3&&(vt=""+r.data+"",vt.length==0||/^[\n\r]+$/.test(vt))){if(dt=r.nextSibling,r.parentNode.removeChild(r),r==l)break;r=dt;continue}f[h]=r;h++}if(r==l)break;r=r.nextSibling}h>0&&(y[s]=f)}return y};Sys.Extended.UI.HTMLEditor.unWrap=function(n,t){var f=this,r,e,u,i;if(n.firstChild){while(n.firstChild&&n.firstChild.nodeType==3&&""+n.firstChild.data+""=="")n.removeChild(n.firstChild);for(r=[];n.firstChild;)n.firstChild!=t[0]&&n.firstChild!=t[1]&&r.push(n.firstChild),n.parentNode.insertBefore(n.firstChild,n);for(r.length==0&&(i=f._doc.createElement("BR"),n.parentNode.insertBefore(i,n)),Sys.Extended.UI.HTMLEditor.isIE&&r.length==1&&r[0].nodeType==3&&(e=""+r[0].data+"",e.length==1&&e.charCodeAt(0)==160&&(i=f._doc.createElement("BR"),r[0].parentNode.insertBefore(i,r[0]),r[0].parentNode.removeChild(r[0])));n.nextSibling&&n.nextSibling.nodeType==3&&""+n.nextSibling.data+""=="";)n.parentNode.removeChild(n.nextSibling);u=n.previousSibling&&t[1]==n.previousSibling?t[1].previousSibling:n.previousSibling;u&&Sys.Extended.UI.HTMLEditor.isInlineElement(u)&&u.nodeType==1&&u.childNodes.length>0&&(u=Sys.Extended.UI.HTMLEditor._getReallyLast(u));Sys.Extended.UI.HTMLEditor.isInlineElement(u)&&n.nextSibling!=null&&(i=f._doc.createElement("BR"),n.parentNode.insertBefore(i,n))}else i=f._doc.createElement("BR"),n.parentNode.insertBefore(i,n);n.parentNode.removeChild(n)};Sys.Extended.UI.HTMLEditor.tryUnWrap=function(n,t,i){var c=this,o,s,e,h;for(n.style.textAlign="",o=0,s=n.attributes,e=0;e<s.length;++e)(h=s.item(e),h.specified)&&h.name.toLowerCase()!="style"&&o++;var l=n.style.cssText,u=0,r,f=n.tagName.toUpperCase();if(!(typeof i!="undefined"&&i)&&f!="LI")try{r=parseInt(Sys.Extended.UI.HTMLEditor.getStyle(n,"margin-top"));isNaN(r)&&(r=f=="P"?1:0);u+=r;r=parseInt(Sys.Extended.UI.HTMLEditor.getStyle(n,"margin-bottom"));isNaN(r)&&(r=f=="P"?1:0);u+=r;r=parseInt(Sys.Extended.UI.HTMLEditor.getStyle(n,"margin-right"));isNaN(r)&&(r=f=="P"?1:0);u+=r;r=parseInt(Sys.Extended.UI.HTMLEditor.getStyle(n,"margin-left"));isNaN(r)&&(r=f=="P"?1:0);u+=r}catch(a){u=1}return n.style.margin="",o==0&&n.style.cssText.length==0&&u==0||typeof i!="undefined"&&i&&f!="LI"?(c.unWrap(n,t),!0):(n.style.cssText=l,!1)};Sys.Extended.UI.HTMLEditor._queryCommandValue=function(n,t){var e=this._rangeStartEnd(),o,s,u,r,i,f,h,c;if(e==null)return"";try{if(n.toLowerCase()=="backcolor"){for(o=e.start;o;){if(s=Sys.Extended.UI.HTMLEditor.getStyle(o,"background-color").toLowerCase(),s.length>0&&s!="transparent")return s;o=o.parentNode}return"#FFFFFF"}u="none";switch(n.toLowerCase()){case"forecolor":u="color";break;case"fontname":u="font-family";break;case"fontsize":u="font-size"}if((u=="font-size"||u=="font-family")&&this._FontNotSet)for(r="",i=e.start;i!=null;){if(u=="font-size"){if(i.style&&i.style.fontSize&&i.style.fontSize.length>0){r=i.style.fontSize;break}else if(i.tagName&&i.tagName.toUpperCase()=="FONT"&&i.size&&i.size.length>0){r=Sys.Extended.UI.HTMLEditor.fontSizeSeek(i.size);break}}else if(i.style&&i.style.fontFamily&&i.style.fontFamily.length>0){r=i.style.fontFamily;break}else if(i.tagName&&i.tagName.toUpperCase()=="FONT"&&i.face&&i.face.length>0){r=i.face;break}if(i.className&&i.className.length>0){r=Sys.Extended.UI.HTMLEditor.getStyle(i,u).toLowerCase();u=="font-size"&&(Sys.Extended.UI.HTMLEditor.isIE||(r=Sys.Extended.UI.HTMLEditor._TryTransformFromPxToPt(r,this,t)));break}if(f=i.tagName.toUpperCase(),f=="BODY"||f=="TD")break;i=i.parentNode}else if(r=Sys.Extended.UI.HTMLEditor.getStyle(e.start,u).toLowerCase(),u=="font-size"&&!Sys.Extended.UI.HTMLEditor.isIE)for(r=Sys.Extended.UI.HTMLEditor._TryTransformFromPxToPt(r,this,t),i=e.start;i!=null;){if(i.style&&i.style.fontSize&&i.style.fontSize.length>0){r=i.style.fontSize;break}if(i.className&&i.className.length>0)break;if(f=i.tagName.toUpperCase(),f=="BODY"||f=="TD")break;i=i.parentNode}if(this._StyleForTyping!=null&&this._StyleForTyping.length>0)for(h=0;h<this._StyleForTyping.length;h++)if(c=this._StyleForTyping[h],c.name==u){r=c.value;break}return r}catch(l){return""}};