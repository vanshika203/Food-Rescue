Type.registerNamespace("Sys.Extended.UI.AjaxFileUpload");Type.registerNamespace("AjaxFileUpload");Sys.Extended.UI.AjaxFileUpload.ProcessorHtml5=function(n,t){var u=new Sys.Extended.UI.AjaxFileUpload.Utils,i=n.get_chunkSize()*1e3,r=0,f=null;this.initialize=function(){$common.setVisible(t.dropZone,!0);t.dropZone.innerHTML=Sys.Extended.UI.Resources.AjaxFileUpload_DropFiles;this.attachEvents()};this.attachEvents=function(){this.onFileDropped$delegate=Function.createDelegate(this,this.onFileDroppedHandler);this.onFileDragOver$delegate=Function.createDelegate(this,this.onFileDragOverHandler);this.onFileSelected$delegate=Function.createDelegate(this,this.onFileSelectedHandler);t.inputFile.addEventListener("change",this.onFileSelected$delegate,!1);t.dropZone.addEventListener("drop",this.onFileDropped$delegate,!1);t.dropZone.addEventListener("dragover",this.onFileDragOver$delegate,!1)};this.onFileDroppedHandler=function(n){n.stopPropagation();n.preventDefault();this.addFilesToQueue(n.dataTransfer.files)};this.onFileDragOverHandler=function(n){n.stopPropagation();n.preventDefault()};this.onFileSelectedHandler=function(n){this.addFilesToQueue(n.target.files)};this.addFilesToQueue=function(r){for(var o,s,e,f=0;f<r.length;f++)if(o=r[f],s=0,o.size>i&&(s=Math.ceil(o.size/i)),e={id:u.generateGuid(),value:r[f],type:u.getFileType(r[f]),uploaded:!1,slices:s},n.fileTypeIsValid(e.type)){if(!n.addFileToQueue(e))break}else n.confirmFileIsInvalid(e);t.inputFile.value=null};this.cancelUpload=function(){f&&f.abort();n.cancelUpload()};this.startUpload=function(){var i=n.getNextFile();i?(i._sliceIndex===0&&n.setPercent(0),$common.setVisible(t.progressBarContainer,!0),this.upload(i)):(n._currentFileId=null,n.setPercent(0),$common.setVisible(t.progressBarContainer,!1),n.done())};this.upload=function(r){var o,s;if(n._isUploading){$common.setVisible(t.progressBar,!0);n.setAsUploading(r);var f=r.get_inputElementValue(),a=r._fileName,h=r._slices&&r._slices>0,v=r._sliceIndex==0;h&&(o=r._sliceIndex*i,s=o+i,f=f.slice(o,s>f.size?f.size:s));var c=new FormData,l=n._currentFileId=r._id,u=new XMLHttpRequest,y=this,e=function(n){return function(t){n.call(y,l,t)}};u.upload.addEventListener("progress",e(this.onProgressHandler),!1);u.addEventListener("load",e(this.onUploadCompleteHandler),!1);u.addEventListener("error",e(this.onUploadFailedHandler),!1);u.addEventListener("abort",e(this.onUploadCanceledHandler),!1);u.open("POST",n._uploadUrl+"?contextKey="+n._contextKey+"&fileId="+l+"&fileName="+a+"&chunked="+(h?"true":"false")+"&firstChunk="+v+"&storeToAzure="+n.get_storeToAzure()+"&acn="+n.get_azureContainerName(),!0);c.append("act-file-data",f);u.send(c)}};this.onProgressHandler=function(t,i){if(n._isUploading&&i.lengthComputable){r=i.loaded;var u=n.getFileItem(t),f=u._slices,e=u._bytesUploaded+r,o=f-u._sliceIndex==1?e:i.total*f,s=f==0?(i.loaded*100/i.total).toFixed(2):(e/o*100).toFixed(2);n.setPercent(s)}};this.onUploadCompleteHandler=function(t){var e=this,i=n.getFileItem(t),f=i.get_inputElementValue();i._slices&&i._slices>0&&i._sliceIndex+1<i._slices?(i._sliceIndex++,i._bytesUploaded+=r,r=0,e.startUpload()):(i.hide(),i.setStatus("uploaded",Sys.Extended.UI.Resources.AjaxFileUpload_Uploaded),n.setStatusMessage(String.format(Sys.Extended.UI.Resources.AjaxFileUpload_UploadingHtml5File,f.name,u.sizeToString(f.size))),n.doneAndUploadNextFile(i))};this.onUploadFailedHandler=function(t,i){var r=n.getFileItem(t);r._isUploading=!1;n.setFileStatus(t,"error",Sys.Extended.UI.Resources.AjaxFileUpload_error);n.raiseUploadError(i)};this.onUploadCanceledHandler=function(t){var i=n.getFileItem(t);i._isUploading=!1;n.setFileStatus(i,"canceled",Sys.Extended.UI.Resources.AjaxFileUpload_Canceled)}};