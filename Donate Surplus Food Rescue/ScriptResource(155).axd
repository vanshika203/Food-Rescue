// (c) 2010 CodePlex Foundation
Type.registerNamespace("Sys.Extended.UI.Seadragon");Sys.Extended.UI.Seadragon.Job=function(n,t){this._image=null;this._timeout=null;this._src=n;this._callback=t;this.TIMEOUT=5e3};Sys.Extended.UI.Seadragon.Job.prototype={_finish:function(n){this._image.onload=null;this._image.onabort=null;this._image.onerror=null;this._timeout&&window.clearTimeout(this._timeout);var t=this._image,i=this._callback;window.setTimeout(function(){i(this._src,n?t:null)},1)},_onloadHandler:function(){this._finish(!0)},_onerrorHandler:function(){this._finish(!1)},start:function(){this._image=new Image;this._image.onload=Function.createDelegate(this,this._onloadHandler);this._image.onabort=Function.createDelegate(this,this._onerrorHandler);this._image.onerror=Function.createDelegate(this,this._onerrorHandler);this._timeout=window.setTimeout(Function.createDelegate(this,this._onerrorHandler),this.TIMEOUT);this._image.src=this._src}};Sys.Extended.UI.Seadragon.Job.registerClass("Sys.Extended.UI.Seadragon.Job",null,Sys.IDisposable);Sys.Extended.UI.Seadragon.ImageLoader=function(n){this._downloading=0;this.imageLoaderLimit=n};Sys.Extended.UI.Seadragon.ImageLoader.prototype={_onComplete:function(n,t,i){if(this._downloading--,typeof n=="function")try{n(i)}catch(r){Seadragon.Debug.error(r.name+" while executing "+t+" callback: "+r.message,r)}},loadImage:function(n,t){if(this._downloading>=this.imageLoaderLimit)return!1;var i=Seadragon.Utils.createCallback(null,Function.createDelegate(this,this._onComplete),t),r=new Sys.Extended.UI.Seadragon.Job(n,i);return this._downloading++,r.start(),!0}};Sys.Extended.UI.Seadragon.ImageLoader.registerClass("Sys.Extended.UI.Seadragon.ImageLoader",null,Sys.IDisposable);